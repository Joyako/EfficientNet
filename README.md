## Face Recognition in PyTorch 
### This project mainly contains various loss function and light neural network.

### Light Neural Network
<li> MobileNet-v3
<li> EfficientNet

### Loss function:  
These functions addresses deep face recognition (FR) problem under open-set protocol, 
where ideal face features are expected to have smaller maximal intra-class distance 
than minimal inter-class distance under a suitably chosen met- ric space.
<li> Softmax:  

<a href="https://www.codecogs.com/eqnedit.php?latex=L_{1}=-\frac{1}{N}&space;\sum_{i=1}^{N}&space;\log&space;\frac{e^{W_{y_{i}}^{T}&space;x_{i}&plus;b_{y_{i}}}}{\sum_{j=1}^{n}&space;e^{W_{j}^{T}&space;x_{i}&plus;b_{j}}}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?L_{1}=-\frac{1}{N}&space;\sum_{i=1}^{N}&space;\log&space;\frac{e^{W_{y_{i}}^{T}&space;x_{i}&plus;b_{y_{i}}}}{\sum_{j=1}^{n}&space;e^{W_{j}^{T}&space;x_{i}&plus;b_{j}}}" title="L_{1}=-\frac{1}{N} \sum_{i=1}^{N} \log \frac{e^{W_{y_{i}}^{T} x_{i}+b_{y_{i}}}}{\sum_{j=1}^{n} e^{W_{j}^{T} x_{i}+b_{j}}}" /></a>
<li> CenterLoss:   

<a href="https://www.codecogs.com/eqnedit.php?latex=\mathcal{L}_{C}=\frac{1}{2}&space;\sum_{i=1}^{m}\left\|\boldsymbol{x}_{i}-\boldsymbol{c}_{y_{i}}\right\|_{2}^{2}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\mathcal{L}_{C}=\frac{1}{2}&space;\sum_{i=1}^{m}\left\|\boldsymbol{x}_{i}-\boldsymbol{c}_{y_{i}}\right\|_{2}^{2}" title="\mathcal{L}_{C}=\frac{1}{2} \sum_{i=1}^{m}\left\|\boldsymbol{x}_{i}-\boldsymbol{c}_{y_{i}}\right\|_{2}^{2}" /></a>
<li> L-Softmax:

<a href="https://www.codecogs.com/eqnedit.php?latex=L_{i}=-\log&space;\left(\frac{e^{\left\|\boldsymbol{W}_{y_{i}}\right\|\left\|\boldsymbol{x}_{i}\right\|&space;\psi\left(\theta_{y_{i}}\right)}}{e^{\left\|\boldsymbol{W}_{y_{i}}\right\|\left\|\boldsymbol{x}_{i}\right\|&space;\psi\left(\theta_{y_{i}}\right)}&plus;\sum_{j&space;\neq&space;y_{i}}&space;e^{\left\|\boldsymbol{W}_{j}\right\|\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{j}\right)}}\right)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?L_{i}=-\log&space;\left(\frac{e^{\left\|\boldsymbol{W}_{y_{i}}\right\|\left\|\boldsymbol{x}_{i}\right\|&space;\psi\left(\theta_{y_{i}}\right)}}{e^{\left\|\boldsymbol{W}_{y_{i}}\right\|\left\|\boldsymbol{x}_{i}\right\|&space;\psi\left(\theta_{y_{i}}\right)}&plus;\sum_{j&space;\neq&space;y_{i}}&space;e^{\left\|\boldsymbol{W}_{j}\right\|\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{j}\right)}}\right)" title="L_{i}=-\log \left(\frac{e^{\left\|\boldsymbol{W}_{y_{i}}\right\|\left\|\boldsymbol{x}_{i}\right\| \psi\left(\theta_{y_{i}}\right)}}{e^{\left\|\boldsymbol{W}_{y_{i}}\right\|\left\|\boldsymbol{x}_{i}\right\| \psi\left(\theta_{y_{i}}\right)}+\sum_{j \neq y_{i}} e^{\left\|\boldsymbol{W}_{j}\right\|\left\|\boldsymbol{x}_{i}\right\| \cos \left(\theta_{j}\right)}}\right)" /></a>

where  
<a href="https://www.codecogs.com/eqnedit.php?latex=\psi(\theta)=\left\{\begin{array}{ll}&space;\cos&space;(m&space;\theta),&space;&&space;0&space;\leq&space;\theta&space;\leq&space;\frac{\pi}{m}&space;\\&space;\mathcal{D}(\theta),&space;\quad&space;\frac{\pi}{m}<\theta&space;\leq&space;\pi&space;\end{array}\right." target="_blank"><img src="https://latex.codecogs.com/gif.latex?\psi(\theta)=\left\{\begin{array}{ll}&space;\cos&space;(m&space;\theta),&space;&&space;0&space;\leq&space;\theta&space;\leq&space;\frac{\pi}{m}&space;\\&space;\mathcal{D}(\theta),&space;\quad&space;\frac{\pi}{m}<\theta&space;\leq&space;\pi&space;\end{array}\right." title="\psi(\theta)=\left\{\begin{array}{ll} \cos (m \theta), & 0 \leq \theta \leq \frac{\pi}{m} \\ \mathcal{D}(\theta), \quad \frac{\pi}{m}<\theta \leq \pi \end{array}\right." /></a>

Calculate phi(theta) and k:  
<a href="https://www.codecogs.com/eqnedit.php?latex=\psi(\theta)=(-1)^{k}&space;\cos&space;(m&space;\theta)-2&space;k,&space;\quad&space;\theta&space;\in\left[\frac{k&space;\pi}{m},&space;\frac{(k&plus;1)&space;\pi}{m}\right]" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\psi(\theta)=(-1)^{k}&space;\cos&space;(m&space;\theta)-2&space;k,&space;\quad&space;\theta&space;\in\left[\frac{k&space;\pi}{m},&space;\frac{(k&plus;1)&space;\pi}{m}\right]" title="\psi(\theta)=(-1)^{k} \cos (m \theta)-2 k, \quad \theta \in\left[\frac{k \pi}{m}, \frac{(k+1) \pi}{m}\right]" /></a> 

Calculate cos(m * theta):  
<a href="https://www.codecogs.com/eqnedit.php?latex=\begin{aligned}&space;\cos&space;\left(m&space;\theta_{y_{i}}\right)&space;&=C_{m}^{0}&space;\cos&space;^{m}\left(\theta_{y_{i}}\right)-C_{m}^{2}&space;\cos&space;^{m-2}\left(\theta_{y_{i}}\right)\left(1-\cos&space;^{2}\left(\theta_{y_{i}}\right)\right)&space;\\&space;&&plus;C_{m}^{4}&space;\cos&space;^{m-4}\left(\theta_{y_{i}}\right)\left(1-\cos&space;^{2}\left(\theta_{y_{i}}\right)\right)^{2}&plus;\cdots&space;\\&space;&(-1)^{n}&space;C_{m}^{2&space;n}&space;\cos&space;^{m-2&space;n}\left(\theta_{y_{i}}\right)\left(1-\cos&space;^{2}\left(\theta_{y_{i}}\right)\right)^{n}&plus;\cdots&space;\end{aligned}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\begin{aligned}&space;\cos&space;\left(m&space;\theta_{y_{i}}\right)&space;&=C_{m}^{0}&space;\cos&space;^{m}\left(\theta_{y_{i}}\right)-C_{m}^{2}&space;\cos&space;^{m-2}\left(\theta_{y_{i}}\right)\left(1-\cos&space;^{2}\left(\theta_{y_{i}}\right)\right)&space;\\&space;&&plus;C_{m}^{4}&space;\cos&space;^{m-4}\left(\theta_{y_{i}}\right)\left(1-\cos&space;^{2}\left(\theta_{y_{i}}\right)\right)^{2}&plus;\cdots&space;\\&space;&(-1)^{n}&space;C_{m}^{2&space;n}&space;\cos&space;^{m-2&space;n}\left(\theta_{y_{i}}\right)\left(1-\cos&space;^{2}\left(\theta_{y_{i}}\right)\right)^{n}&plus;\cdots&space;\end{aligned}" title="\begin{aligned} \cos \left(m \theta_{y_{i}}\right) &=C_{m}^{0} \cos ^{m}\left(\theta_{y_{i}}\right)-C_{m}^{2} \cos ^{m-2}\left(\theta_{y_{i}}\right)\left(1-\cos ^{2}\left(\theta_{y_{i}}\right)\right) \\ &+C_{m}^{4} \cos ^{m-4}\left(\theta_{y_{i}}\right)\left(1-\cos ^{2}\left(\theta_{y_{i}}\right)\right)^{2}+\cdots \\ &(-1)^{n} C_{m}^{2 n} \cos ^{m-2 n}\left(\theta_{y_{i}}\right)\left(1-\cos ^{2}\left(\theta_{y_{i}}\right)\right)^{n}+\cdots \end{aligned}" /></a>
<li> Angular-Softmax: 

<a href="https://www.codecogs.com/eqnedit.php?latex=L_{\text&space;{modified&space;}}=\frac{1}{N}&space;\sum_{i}-\log&space;\left(\frac{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{y_{i},&space;i}\right)}}{\sum_{j}&space;e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{j,&space;i}\right)}}\right)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?L_{\text&space;{modified&space;}}=\frac{1}{N}&space;\sum_{i}-\log&space;\left(\frac{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{y_{i},&space;i}\right)}}{\sum_{j}&space;e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{j,&space;i}\right)}}\right)" title="L_{\text {modified }}=\frac{1}{N} \sum_{i}-\log \left(\frac{e^{\left\|\boldsymbol{x}_{i}\right\| \cos \left(\theta_{y_{i}, i}\right)}}{\sum_{j} e^{\left\|\boldsymbol{x}_{i}\right\| \cos \left(\theta_{j, i}\right)}}\right)" /></a>

<a href="https://www.codecogs.com/eqnedit.php?latex=L_{\mathrm{ang}}=\frac{1}{N}&space;\sum_{i}-\log&space;\left(\frac{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(m&space;\theta_{y_{i},&space;i}\right)}}{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(m&space;\theta_{y_{i},&space;i}\right)}&plus;\sum_{j&space;\neq&space;y_{i}}&space;e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{j,&space;i}\right)}}\right)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?L_{\mathrm{ang}}=\frac{1}{N}&space;\sum_{i}-\log&space;\left(\frac{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(m&space;\theta_{y_{i},&space;i}\right)}}{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(m&space;\theta_{y_{i},&space;i}\right)}&plus;\sum_{j&space;\neq&space;y_{i}}&space;e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{j,&space;i}\right)}}\right)" title="L_{\mathrm{ang}}=\frac{1}{N} \sum_{i}-\log \left(\frac{e^{\left\|\boldsymbol{x}_{i}\right\| \cos \left(m \theta_{y_{i}, i}\right)}}{e^{\left\|\boldsymbol{x}_{i}\right\| \cos \left(m \theta_{y_{i}, i}\right)}+\sum_{j \neq y_{i}} e^{\left\|\boldsymbol{x}_{i}\right\| \cos \left(\theta_{j, i}\right)}}\right)" /></a>

<a href="https://www.codecogs.com/eqnedit.php?latex=L_{\text&space;{ang&space;}}=\frac{1}{N}&space;\sum_{i}-\log&space;\left(\frac{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\psi\left(\theta_{y_{i}},&space;i\right)}}{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\psi\left(\theta_{y_{i},&space;i}\right)}&plus;\sum_{j&space;\neq&space;y_{i}}&space;e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{j,&space;i}\right)}}\right)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?L_{\text&space;{ang&space;}}=\frac{1}{N}&space;\sum_{i}-\log&space;\left(\frac{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\psi\left(\theta_{y_{i}},&space;i\right)}}{e^{\left\|\boldsymbol{x}_{i}\right\|&space;\psi\left(\theta_{y_{i},&space;i}\right)}&plus;\sum_{j&space;\neq&space;y_{i}}&space;e^{\left\|\boldsymbol{x}_{i}\right\|&space;\cos&space;\left(\theta_{j,&space;i}\right)}}\right)" title="L_{\text {ang }}=\frac{1}{N} \sum_{i}-\log \left(\frac{e^{\left\|\boldsymbol{x}_{i}\right\| \psi\left(\theta_{y_{i}}, i\right)}}{e^{\left\|\boldsymbol{x}_{i}\right\| \psi\left(\theta_{y_{i}, i}\right)}+\sum_{j \neq y_{i}} e^{\left\|\boldsymbol{x}_{i}\right\| \cos \left(\theta_{j, i}\right)}}\right)" /></a>

<li> Cosine-Softmax: 

<a href="https://www.codecogs.com/eqnedit.php?latex=L_{l&space;m&space;c}=\frac{1}{N}&space;\sum_{i}-\log&space;\frac{e^{s\left(\cos&space;\left(\theta_{y_{i},&space;i}\right)-m\right)}}{e^{s\left(\cos&space;\left(\theta_{y_{i},&space;i}\right)-m\right)}&plus;\sum_{j&space;\neq&space;y_{i}}&space;e^{s&space;\cos&space;\left(\theta_{j,&space;i}\right)}}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?L_{l&space;m&space;c}=\frac{1}{N}&space;\sum_{i}-\log&space;\frac{e^{s\left(\cos&space;\left(\theta_{y_{i},&space;i}\right)-m\right)}}{e^{s\left(\cos&space;\left(\theta_{y_{i},&space;i}\right)-m\right)}&plus;\sum_{j&space;\neq&space;y_{i}}&space;e^{s&space;\cos&space;\left(\theta_{j,&space;i}\right)}}" title="L_{l m c}=\frac{1}{N} \sum_{i}-\log \frac{e^{s\left(\cos \left(\theta_{y_{i}, i}\right)-m\right)}}{e^{s\left(\cos \left(\theta_{y_{i}, i}\right)-m\right)}+\sum_{j \neq y_{i}} e^{s \cos \left(\theta_{j, i}\right)}}" /></a>

where,
<a href="https://www.codecogs.com/eqnedit.php?latex=\begin{aligned}&space;W&space;&=\frac{W^{*}}{\left\|W^{*}\right\|}&space;\\&space;x&space;&=\frac{x^{*}}{\left\|x^{*}\right\|}&space;\\&space;\cos&space;\left(\theta_{j},&space;i\right)&space;&=W_{j}^{T}&space;x_{i}&space;\end{aligned}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\begin{aligned}&space;W&space;&=\frac{W^{*}}{\left\|W^{*}\right\|}&space;\\&space;x&space;&=\frac{x^{*}}{\left\|x^{*}\right\|}&space;\\&space;\cos&space;\left(\theta_{j},&space;i\right)&space;&=W_{j}^{T}&space;x_{i}&space;\end{aligned}" title="\begin{aligned} W &=\frac{W^{*}}{\left\|W^{*}\right\|} \\ x &=\frac{x^{*}}{\left\|x^{*}\right\|} \\ \cos \left(\theta_{j}, i\right) &=W_{j}^{T} x_{i} \end{aligned}" /></a>




<li> ArcFace:  

<a href="https://www.codecogs.com/eqnedit.php?latex=L=-\frac{1}{N}&space;\sum_{i=1}^{N}&space;\log&space;\frac{e^{s\left(\cos&space;\left(m_{1}&space;\theta_{y_{i}}&plus;m_{2}\right)-m_{3}\right)}}{e^{s\left(\cos&space;\left(m_{1}&space;\theta_{y_{i}}&plus;m_{2}\right)-m_{3}\right)}&plus;\sum_{j=1,&space;j&space;\neq&space;y_{i}}^{n}&space;e^{s&space;\cos&space;\theta_{j}}}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?L_{4}=-\frac{1}{N}&space;\sum_{i=1}^{N}&space;\log&space;\frac{e^{s\left(\cos&space;\left(m_{1}&space;\theta_{y_{i}}&plus;m_{2}\right)-m_{3}\right)}}{e^{s\left(\cos&space;\left(m_{1}&space;\theta_{y_{i}}&plus;m_{2}\right)-m_{3}\right)}&plus;\sum_{j=1,&space;j&space;\neq&space;y_{i}}^{n}&space;e^{s&space;\cos&space;\theta_{j}}}" title="L_{4}=-\frac{1}{N} \sum_{i=1}^{N} \log \frac{e^{s\left(\cos \left(m_{1} \theta_{y_{i}}+m_{2}\right)-m_{3}\right)}}{e^{s\left(\cos \left(m_{1} \theta_{y_{i}}+m_{2}\right)-m_{3}\right)}+\sum_{j=1, j \neq y_{i}}^{n} e^{s \cos \theta_{j}}}" /></a>   


### Reference
<li> https://github.com/MuggleWang/CosFace_pytorch/blob/master/layer.py  
<li> ArcFace: Additive Angular Margin Loss for Deep Face Recognition
<li> SphereFace: Deep Hypersphere Embedding for Face Recognition  
<li> A Discriminative Feature Learning Approach for Deep Face Recognition  
<li> CosFace: Large Margin Cosine Loss for Deep Face Recognition   
<li> Large-Margin Softmax Loss for Convolutional Neural Networks
<li> [EfficientNet](https://arxiv.org/pdf/1905.11946.pdf)
<li> MobileNet-v3

